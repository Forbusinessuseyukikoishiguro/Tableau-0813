# Tableau + Pythonäºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ä½œæˆ å®Œå…¨ã‚¬ã‚¤ãƒ‰

## ğŸ 1. Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1.1 å¿…è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# TabPyï¼ˆTableau-Pythoné€£æºï¼‰
pip install tabpy

# æ©Ÿæ¢°å­¦ç¿’ãƒ»äºˆæ¸¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pip install pandas numpy scikit-learn
pip install statsmodels pmdarima
pip install matplotlib seaborn
pip install tensorflow keras  # ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# è¿½åŠ ã®ä¾¿åˆ©ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pip install plotly fbprophet xgboost lightgbm
```

### 1.2 TabPyã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§TabPyã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
tabpy

# ã¾ãŸã¯è©³ç´°è¨­å®šã§èµ·å‹•
tabpy --config=config.conf
```

### 1.3 Tableauè¨­å®š
```
1. Tableau Desktop ã‚’é–‹ã
2. ãƒ˜ãƒ«ãƒ— â†’ è¨­å®šã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ â†’ æ‹¡å¼µæ©Ÿèƒ½æ¥ç¶šã®ç®¡ç†
3. TabPy/External APIè¨­å®š:
   - ã‚µãƒ¼ãƒãƒ¼: localhost
   - ãƒãƒ¼ãƒˆ: 9004
   - ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒå¿…è¦: ãƒã‚§ãƒƒã‚¯ã—ãªã„
```

---

## ğŸš€ 2. åŸºæœ¬çš„ãªPythonäºˆæ¸¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### 2.1 ã‚·ãƒ³ãƒ—ãƒ«ãªç·šå½¢å›å¸°äºˆæ¸¬
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Linear_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression

# Tableauã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Š
sales_data = _arg1
dates = _arg2

# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ
df = pd.DataFrame({
    'sales': sales_data,
    'time_index': range(len(sales_data))
})

# ãƒ¢ãƒ‡ãƒ«å­¦ç¿’
X = df[['time_index']]
y = df['sales']
model = LinearRegression()
model.fit(X, y)

# å°†æ¥12æœŸé–“ã®äºˆæ¸¬
future_periods = 12
future_X = np.array(range(len(sales_data), len(sales_data) + future_periods)).reshape(-1, 1)
predictions = model.predict(future_X)

return predictions.tolist()
", SUM([Sales]), [Date])
```

### 2.2 ARIMAæ™‚ç³»åˆ—äºˆæ¸¬
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [ARIMA_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from statsmodels.tsa.arima.model import ARIMA
import warnings
warnings.filterwarnings('ignore')

# ãƒ‡ãƒ¼ã‚¿æº–å‚™
sales_data = pd.Series(_arg1)

# ARIMAãƒ¢ãƒ‡ãƒ«ï¼ˆè‡ªå‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é¸æŠï¼‰
try:
    model = ARIMA(sales_data, order=(1,1,1))
    fitted_model = model.fit()
    
    # 12æœŸé–“å…ˆã®äºˆæ¸¬
    forecast = fitted_model.forecast(steps=12)
    confidence_intervals = fitted_model.get_forecast(steps=12).conf_int()
    
    return forecast.tolist()
except:
    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç§»å‹•å¹³å‡ã§ä»£æ›¿
    return [sales_data.mean()] * 12
", SUM([Sales]))
```

### 2.3 æ©Ÿæ¢°å­¦ç¿’ï¼ˆRandom Forestï¼‰äºˆæ¸¬
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [ML_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split

# ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
def create_features(data):
    df = pd.DataFrame({'value': data})
    df['lag_1'] = df['value'].shift(1)
    df['lag_3'] = df['value'].shift(3)
    df['lag_12'] = df['value'].shift(12)
    df['ma_3'] = df['value'].rolling(3).mean()
    df['ma_12'] = df['value'].rolling(12).mean()
    df['trend'] = range(len(df))
    df['season'] = [i % 12 for i in range(len(df))]
    return df.fillna(method='bfill').fillna(method='ffill')

# ãƒ‡ãƒ¼ã‚¿æº–å‚™
sales_data = _arg1
df = create_features(sales_data)

# ãƒ¢ãƒ‡ãƒ«å­¦ç¿’
feature_cols = ['lag_1', 'lag_3', 'lag_12', 'ma_3', 'ma_12', 'trend', 'season']
X = df[feature_cols]
y = df['value']

# æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§ãƒ¢ãƒ‡ãƒ«å­¦ç¿’
model = RandomForestRegressor(n_estimators=50, random_state=42)
model.fit(X, y)

# å°†æ¥äºˆæ¸¬ï¼ˆé€æ¬¡äºˆæ¸¬ï¼‰
predictions = []
last_features = X.iloc[-1].copy()

for i in range(12):
    pred = model.predict([last_features])[0]
    predictions.append(pred)
    
    # ç‰¹å¾´é‡æ›´æ–°
    last_features['lag_1'] = pred
    last_features['trend'] += 1
    last_features['season'] = (last_features['season'] + 1) % 12

return predictions
", SUM([Sales]))
```

---

## ğŸ“Š 3. é«˜åº¦ãªPythonäºˆæ¸¬ãƒ¢ãƒ‡ãƒ«

### 3.1 Facebook Prophetï¼ˆå­£ç¯€æ€§ç‰¹åŒ–ï¼‰
```python
# äº‹å‰ã«TabPyã‚µãƒ¼ãƒãƒ¼ã«Prophetã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Prophet_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from fbprophet import Prophet
import warnings
warnings.filterwarnings('ignore')

# ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆProphetã®å½¢å¼ã«å¤‰æ›ï¼‰
dates = pd.to_datetime(_arg1)
sales = _arg2

df = pd.DataFrame({
    'ds': dates,
    'y': sales
})

# Prophetãƒ¢ãƒ‡ãƒ«
model = Prophet(
    yearly_seasonality=True,
    weekly_seasonality=False,
    daily_seasonality=False,
    changepoint_prior_scale=0.05
)

model.fit(df)

# å°†æ¥12ãƒ¶æœˆã®äºˆæ¸¬
future = model.make_future_dataframe(periods=12, freq='M')
forecast = model.predict(future)

# äºˆæ¸¬å€¤ã®ã¿ã‚’è¿”ã™ï¼ˆæœ€å¾Œã®12å€‹ï¼‰
return forecast['yhat'].tail(12).tolist()
", [Date], SUM([Sales]))
```

### 3.2 XGBoostï¼ˆé«˜ç²¾åº¦æ©Ÿæ¢°å­¦ç¿’ï¼‰
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [XGBoost_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
import xgboost as xgb
from sklearn.metrics import mean_squared_error

def engineer_features(data, window_sizes=[3, 6, 12]):
    df = pd.DataFrame({'target': data})
    
    # ãƒ©ã‚°ç‰¹å¾´é‡
    for lag in [1, 2, 3, 6, 12]:
        df[f'lag_{lag}'] = df['target'].shift(lag)
    
    # ç§»å‹•å¹³å‡
    for window in window_sizes:
        df[f'ma_{window}'] = df['target'].rolling(window).mean()
        df[f'std_{window}'] = df['target'].rolling(window).std()
    
    # å·®åˆ†ç‰¹å¾´é‡
    df['diff_1'] = df['target'].diff(1)
    df['diff_12'] = df['target'].diff(12)
    
    # æ™‚é–“ç‰¹å¾´é‡
    df['time_idx'] = range(len(df))
    df['month'] = [i % 12 for i in range(len(df))]
    df['quarter'] = [(i // 3) % 4 for i in range(len(df))]
    
    return df

# ãƒ‡ãƒ¼ã‚¿æº–å‚™
sales_data = _arg1
df = engineer_features(sales_data)

# æ¬ æå€¤å‡¦ç†
df = df.fillna(method='bfill').fillna(method='ffill')

# ç‰¹å¾´é‡ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ†é›¢
feature_cols = [col for col in df.columns if col != 'target']
X = df[feature_cols]
y = df['target']

# XGBoostãƒ¢ãƒ‡ãƒ«
model = xgb.XGBRegressor(
    n_estimators=100,
    max_depth=6,
    learning_rate=0.1,
    random_state=42
)

model.fit(X, y)

# é€æ¬¡äºˆæ¸¬
predictions = []
last_row = X.iloc[-1].copy()

for step in range(12):
    pred = model.predict([last_row])[0]
    predictions.append(pred)
    
    # ç‰¹å¾´é‡æ›´æ–°ï¼ˆç°¡ç•¥åŒ–ï¼‰
    last_row['lag_1'] = pred
    last_row['time_idx'] += 1
    last_row['month'] = (last_row['month'] + 1) % 12
    
return predictions
", SUM([Sales]))
```

### 3.3 LSTMï¼ˆãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [LSTM_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense
from sklearn.preprocessing import MinMaxScaler
import warnings
warnings.filterwarnings('ignore')

def create_sequences(data, seq_length=12):
    scaler = MinMaxScaler()
    scaled_data = scaler.fit_transform(data.reshape(-1, 1))
    
    X, y = [], []
    for i in range(seq_length, len(scaled_data)):
        X.append(scaled_data[i-seq_length:i, 0])
        y.append(scaled_data[i, 0])
    
    return np.array(X), np.array(y), scaler

# ãƒ‡ãƒ¼ã‚¿æº–å‚™
sales_data = np.array(_arg1)

if len(sales_data) < 24:
    # ãƒ‡ãƒ¼ã‚¿ä¸è¶³æ™‚ã¯ç§»å‹•å¹³å‡ã§ä»£æ›¿
    return [np.mean(sales_data)] * 12

X, y, scaler = create_sequences(sales_data, seq_length=12)

# LSTMãƒ¢ãƒ‡ãƒ«
model = Sequential([
    LSTM(50, return_sequences=True, input_shape=(12, 1)),
    LSTM(50, return_sequences=False),
    Dense(25),
    Dense(1)
])

model.compile(optimizer='adam', loss='mean_squared_error')

# è¨“ç·´
X = X.reshape((X.shape[0], X.shape[1], 1))
model.fit(X, y, epochs=50, batch_size=32, verbose=0)

# äºˆæ¸¬
last_sequence = sales_data[-12:].reshape(1, 12, 1)
last_sequence_scaled = scaler.transform(last_sequence.reshape(-1, 1)).reshape(1, 12, 1)

predictions_scaled = []
current_seq = last_sequence_scaled

for _ in range(12):
    pred = model.predict(current_seq, verbose=0)[0][0]
    predictions_scaled.append(pred)
    
    # ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ›´æ–°
    current_seq = np.roll(current_seq, -1, axis=1)
    current_seq[0, -1, 0] = pred

# ã‚¹ã‚±ãƒ¼ãƒ«æˆ»ã—
predictions = scaler.inverse_transform(np.array(predictions_scaled).reshape(-1, 1)).flatten()

return predictions.tolist()
", SUM([Sales]))
```

---

## ğŸ¯ 4. è¤‡æ•°ãƒ¢ãƒ‡ãƒ«æ¯”è¼ƒãƒ»ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«

### 4.1 ãƒ¢ãƒ‡ãƒ«ç²¾åº¦æ¯”è¼ƒ
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Model_Accuracy]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.metrics import mean_absolute_error, mean_squared_error

def calculate_accuracy_metrics(actual, predicted):
    mae = mean_absolute_error(actual, predicted)
    mse = mean_squared_error(actual, predicted)
    rmse = np.sqrt(mse)
    mape = np.mean(np.abs((actual - predicted) / actual)) * 100
    
    return {
        'MAE': mae,
        'MSE': mse, 
        'RMSE': rmse,
        'MAPE': mape
    }

# å®Ÿéš›ã®å€¤ã¨äºˆæ¸¬å€¤
actual_values = _arg1
predictions = _arg2

metrics = calculate_accuracy_metrics(actual_values, predictions)

# MAPEã‚’è¿”ã™ï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰
return metrics['MAPE']
", [Actual], [Predicted])
```

### 4.2 ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«äºˆæ¸¬
```python
# Tableauè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Ensemble_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
from sklearn.linear_model import LinearRegression
from statsmodels.tsa.exponential_smoothing.exponential_smoothing import ExponentialSmoothing

def ensemble_forecast(sales_data, n_periods=12):
    # ãƒ¢ãƒ‡ãƒ«1: ç·šå½¢å›å¸°
    X_linear = np.array(range(len(sales_data))).reshape(-1, 1)
    model_linear = LinearRegression()
    model_linear.fit(X_linear, sales_data)
    
    future_X = np.array(range(len(sales_data), len(sales_data) + n_periods)).reshape(-1, 1)
    pred_linear = model_linear.predict(future_X)
    
    # ãƒ¢ãƒ‡ãƒ«2: æŒ‡æ•°å¹³æ»‘æ³•
    try:
        model_exp = ExponentialSmoothing(sales_data, trend='add', seasonal='add', seasonal_periods=12)
        fitted_exp = model_exp.fit()
        pred_exp = fitted_exp.forecast(n_periods)
    except:
        pred_exp = [np.mean(sales_data)] * n_periods
    
    # ãƒ¢ãƒ‡ãƒ«3: Random Forest
    def create_features(data):
        features = []
        for i in range(12, len(data)):
            features.append(data[i-12:i])
        return np.array(features)
    
    if len(sales_data) >= 24:
        X_rf = create_features(sales_data)
        y_rf = sales_data[12:]
        
        model_rf = RandomForestRegressor(n_estimators=50, random_state=42)
        model_rf.fit(X_rf, y_rf)
        
        last_window = sales_data[-12:]
        pred_rf = []
        
        for _ in range(n_periods):
            pred = model_rf.predict([last_window])[0]
            pred_rf.append(pred)
            last_window = np.append(last_window[1:], pred)
    else:
        pred_rf = [np.mean(sales_data)] * n_periods
    
    # ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ï¼ˆé‡ã¿ä»˜ãå¹³å‡ï¼‰
    weights = [0.3, 0.4, 0.3]  # linear, exp, rf
    ensemble_pred = []
    
    for i in range(n_periods):
        weighted_pred = (
            weights[0] * pred_linear[i] +
            weights[1] * pred_exp[i] +
            weights[2] * pred_rf[i]
        )
        ensemble_pred.append(weighted_pred)
    
    return ensemble_pred

sales_data = _arg1
predictions = ensemble_forecast(sales_data, 12)

return predictions
", SUM([Sales]))
```

---

## ğŸ“ˆ 5. å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´

### 5.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãäºˆæ¸¬
```python
# Tableauãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸå‹•çš„äºˆæ¸¬
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: [Forecast_Periods], [Model_Type]

# è¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Dynamic_Forecast]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
from sklearn.linear_model import LinearRegression

def dynamic_forecast(sales_data, periods, model_type):
    if model_type == 'Linear':
        X = np.array(range(len(sales_data))).reshape(-1, 1)
        model = LinearRegression()
        model.fit(X, sales_data)
        
        future_X = np.array(range(len(sales_data), len(sales_data) + periods)).reshape(-1, 1)
        predictions = model.predict(future_X)
        
    elif model_type == 'RandomForest':
        # ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
        df = pd.DataFrame({'sales': sales_data})
        df['lag1'] = df['sales'].shift(1)
        df['ma3'] = df['sales'].rolling(3).mean()
        df['trend'] = range(len(df))
        df = df.fillna(method='bfill')
        
        X = df[['lag1', 'ma3', 'trend']]
        y = df['sales']
        
        model = RandomForestRegressor(n_estimators=50)
        model.fit(X, y)
        
        # é€æ¬¡äºˆæ¸¬
        predictions = []
        last_features = X.iloc[-1].copy()
        
        for i in range(periods):
            pred = model.predict([last_features])[0]
            predictions.append(pred)
            
            last_features['lag1'] = pred
            last_features['trend'] += 1
            
    else:  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šç§»å‹•å¹³å‡
        predictions = [np.mean(sales_data[-12:])] * periods
    
    return predictions

sales_data = _arg1
periods = int(_arg2)
model_type = _arg3

result = dynamic_forecast(sales_data, periods, model_type)
return result
", SUM([Sales]), [Forecast_Periods], [Model_Type])
```

### 5.2 ä¿¡é ¼åŒºé–“ä»˜ãäºˆæ¸¬
```python
# è¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: [Forecast_Upper_Bound]
SCRIPT_REAL("
import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor

def forecast_with_uncertainty(sales_data, confidence_level=0.95):
    # Bootstrapæ³•ã«ã‚ˆã‚‹ä¸ç¢ºå®Ÿæ€§æ¨å®š
    n_bootstrap = 100
    predictions_bootstrap = []
    
    for _ in range(n_bootstrap):
        # ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
        indices = np.random.choice(len(sales_data), len(sales_data), replace=True)
        bootstrap_data = [sales_data[i] for i in indices]
        
        # ç°¡å˜ãªç·šå½¢äºˆæ¸¬
        X = np.array(range(len(bootstrap_data))).reshape(-1, 1)
        model = LinearRegression()
        model.fit(X, bootstrap_data)
        
        future_X = np.array([len(bootstrap_data)]).reshape(-1, 1)
        pred = model.predict(future_X)[0]
        predictions_bootstrap.append(pred)
    
    # ä¿¡é ¼åŒºé–“è¨ˆç®—
    alpha = 1 - confidence_level
    lower_percentile = (alpha/2) * 100
    upper_percentile = (1 - alpha/2) * 100
    
    lower_bound = np.percentile(predictions_bootstrap, lower_percentile)
    upper_bound = np.percentile(predictions_bootstrap, upper_percentile)
    mean_pred = np.mean(predictions_bootstrap)
    
    return [mean_pred, lower_bound, upper_bound]

from sklearn.linear_model import LinearRegression

sales_data = _arg1
result = forecast_with_uncertainty(sales_data)

# ä¸Šé™å€¤ã‚’è¿”ã™
return result[2]
", SUM([Sales]))
```

---

## ğŸ¨ 6. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ

### 6.1 Pythonäºˆæ¸¬çµæœã®å¯è¦–åŒ–

#### ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆè¨­å®š
```
åˆ—: [Date]
è¡Œ: [Sales], [Python_Forecast]
ãƒãƒ¼ã‚¯: ç·šã‚°ãƒ©ãƒ•
è‰²åˆ†ã‘: å®Ÿç¸¾ vs äºˆæ¸¬
```

#### äºˆæ¸¬ç²¾åº¦ãƒ‘ãƒãƒ«
```sql
-- MAPEè¡¨ç¤º
ROUND([Model_Accuracy], 2)

-- ç²¾åº¦è©•ä¾¡
IF [Model_Accuracy] <= 10 THEN "å„ªç§€"
ELSEIF [Model_Accuracy] <= 20 THEN "è‰¯å¥½"  
ELSEIF [Model_Accuracy] <= 30 THEN "æ™®é€š"
ELSE "è¦æ”¹å–„"
END
```

### 6.2 ãƒ¢ãƒ‡ãƒ«é¸æŠã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
```
[Model_Type]: Linear, RandomForest, ARIMA, Ensemble
[Forecast_Periods]: 1ã€œ24
[Confidence_Level]: 80%, 90%, 95%
```

#### å‹•çš„æ›´æ–°
```sql
-- é¸æŠã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã«å¿œã˜ã¦äºˆæ¸¬å®Ÿè¡Œ
CASE [Model_Type]
WHEN "Linear" THEN [Linear_Forecast]
WHEN "RandomForest" THEN [ML_Forecast]  
WHEN "ARIMA" THEN [ARIMA_Forecast]
ELSE [Ensemble_Forecast]
END
```

---

## ğŸš€ 7. æœ¬ç•ªé‹ç”¨ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### 7.1 TabPyã‚µãƒ¼ãƒãƒ¼æœ€é©åŒ–

#### ã‚µãƒ¼ãƒãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆconfig.confï¼‰
```ini
[TabPy]
TABPY_PORT = 9004
TABPY_QUERY_OBJECT_PATH = /tmp/query_objects
TABPY_STATE_PATH = ./tabpy-server

[logging]
TABPY_LOG_LEVEL = INFO
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
```python
# ãƒ¢ãƒ‡ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–
import pickle
import os

def cached_model_predict(data, model_path='forecast_model.pkl'):
    if os.path.exists(model_path):
        with open(model_path, 'rb') as f:
            model = pickle.load(f)
    else:
        # ãƒ¢ãƒ‡ãƒ«å­¦ç¿’
        model = train_new_model(data)
        with open(model_path, 'wb') as f:
            pickle.dump(model, f)
    
    return model.predict(data)
```

### 7.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```python
# å …ç‰¢ãªäºˆæ¸¬é–¢æ•°
SCRIPT_REAL("
import pandas as pd
import numpy as np

def robust_forecast(sales_data):
    try:
        # ãƒ¡ã‚¤ãƒ³äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯
        from sklearn.ensemble import RandomForestRegressor
        # ... äºˆæ¸¬å‡¦ç†
        return predictions
    
    except ImportError:
        # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¶³æ™‚ã®ä»£æ›¿å‡¦ç†
        return [np.mean(sales_data)] * 12
    
    except Exception as e:
        # ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼æ™‚
        return [sales_data[-1]] * 12  # æœ€å¾Œã®å€¤ã‚’ç¹°ã‚Šè¿”ã—

sales_data = _arg1
result = robust_forecast(sales_data)
return result
", SUM([Sales]))
```

### 7.3 ç›£è¦–ã¨ãƒ­ã‚°
```python
# ãƒ­ã‚°ä»˜ãäºˆæ¸¬
SCRIPT_REAL("
import logging
import datetime

# ãƒ­ã‚°è¨­å®š
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def logged_forecast(sales_data):
    try:
        logger.info(f'äºˆæ¸¬é–‹å§‹: {datetime.datetime.now()}')
        logger.info(f'ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°: {len(sales_data)}')
        
        # äºˆæ¸¬å‡¦ç†
        predictions = your_forecast_logic(sales_data)
        
        logger.info(f'äºˆæ¸¬å®Œäº†: {len(predictions)}æœŸé–“')
        return predictions
        
    except Exception as e:
        logger.error(f'äºˆæ¸¬ã‚¨ãƒ©ãƒ¼: {str(e)}')
        return [0] * 12

sales_data = _arg1
result = logged_forecast(sales_data)
return result
", SUM([Sales]))
```

---

## ğŸ’¡ å®Ÿè·µTips

### ã‚ˆãä½¿ã†äºˆæ¸¬ãƒ‘ã‚¿ãƒ¼ãƒ³
1. **é€±æ¬¡å£²ä¸Šäºˆæ¸¬**: `seasonal_periods=52`
2. **æœˆæ¬¡å£²ä¸Šäºˆæ¸¬**: `seasonal_periods=12`  
3. **åœ¨åº«äºˆæ¸¬**: ãƒ©ã‚°ç‰¹å¾´é‡é‡è¦–
4. **éœ€è¦äºˆæ¸¬**: å¤–éƒ¨è¦å› ï¼ˆå¤©æ°—ã€ã‚¤ãƒ™ãƒ³ãƒˆï¼‰è€ƒæ…®

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„å ´åˆã¯ `sampling` ã§å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šæ¸›
- `n_estimators` ã‚’èª¿æ•´ã—ã¦ãƒ¢ãƒ‡ãƒ«è¤‡é›‘åº¦ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
- `verbose=0` ã§ãƒ­ã‚°å‡ºåŠ›ã‚’æŠ‘åˆ¶

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- TabPyæ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ ãƒãƒ¼ãƒˆç¢ºèªã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ãƒ©ãƒ¼ â†’ ä»®æƒ³ç’°å¢ƒã§ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†
- ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ â†’ ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºå‰Šæ¸›ã€ãƒ¢ãƒ‡ãƒ«è»½é‡åŒ–

ã“ã®ã‚¬ã‚¤ãƒ‰ã§Python+Tableauã®å¼·åŠ›ãªäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ãŒæ§‹ç¯‰ã§ãã¾ã™ï¼
